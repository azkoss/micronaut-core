apply plugin: 'com.github.johnrengelman.plugin-shadow'

shadowJar {
    mergeServiceFiles()
    dependencies {
        exclude(project(":core"))

        exclude(dependency(group:'org.slf4j',name:'slf4j-api',version:slf4jVersion))
        exclude(dependency(group: 'javax.inject', name: 'javax.inject', version: '1'))
        exclude(dependency('org.ow2.asm:.*:.*'))
        exclude(dependency('org.reactivestreams:.*:.*'))
        exclude(dependency('com.google.code.findbugs:.*:.*'))
        exclude(dependency('com.github.ben-manes.caffeine:.*:.*'))
    }
    relocate "org.objectweb.asm", "io.micronaut.asm"
    relocate "com.github.benmanes.caffeine", "io.micronaut.caffeine"
}
tasks.withType(com.github.jengelman.gradle.plugins.shadow.tasks.ConfigureShadowRelocation) { t ->
    t.enabled = false
}

dependencies {
    shadowCompile group: 'javax.inject', name: 'javax.inject', version: '1'
    shadowCompile project(":core")

    compile group: 'javax.inject', name: 'javax.inject', version: '1'
    compile project(path: ':core')

    compileOnly "org.codehaus.groovy:groovy:$groovyVersion"
    compileOnly group: 'org.ow2.asm', name: 'asm', version: asmVersion
    compileOnly group: 'org.ow2.asm', name: 'asm-commons', version: asmVersion
    compileOnly group: 'org.ow2.asm', name: 'asm-tree', version: asmVersion
    compileOnly group: 'com.github.ben-manes.caffeine', name: 'caffeine', version: caffeineVersion
    ['javax.validation:validation-api:1.1.0.Final',
     'org.yaml:snakeyaml:1.18'].each { String dep ->
        compileOnly dep
        testCompile dep
    }
}